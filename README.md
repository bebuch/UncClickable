# UncClickable

A browser extension that converts UNC paths (e.g., `\\server\share\folder\`) in `<code>` elements into clickable links using a custom URL scheme.

## Features

- **Cross-browser support**: Works with Firefox 140+, Chrome, and Edge (Manifest V3)
- **Configurable URL scheme**: Default `uncopener://`, customizable
- **URL filtering**: Only active on specified URLs (or everywhere if no URLs configured)
- **UNC prefix filtering**: Only convert specific UNC paths (or all if not configured)
- **Dynamic content support**: Automatically processes dynamically loaded content via MutationObserver
- **Visual status indicator**: Icon changes between color (active) and grayscale (inactive)

## Try It Out

No build step required – the extension is ready to use.

1. Download the repository:
   - Go to the [GitHub repository](https://github.com/bebuch/UncClickable)
   - Click the green **Code** button → **Download ZIP**
   - Extract the ZIP file

2. Load the extension in your browser:

   **Firefox:**
   - Navigate to `about:debugging#/runtime/this-firefox`
   - Click "Load Temporary Add-on..."
   - Select the `manifest.json` file from the extracted folder

   **Chrome/Edge:**
   - Navigate to `chrome://extensions` (or `edge://extensions`)
   - Enable "Developer mode"
   - Click "Load unpacked"
   - Select the extracted folder

## Configuration

Click the extension icon to open the settings page, where you can configure:

### Custom URL Scheme

The protocol used for generated links. Default: `uncopener`

Example: `\\server\path\` → `uncopener://server/path/`

### Active URLs

List of URL prefixes where the extension should be active (one per line).

Examples:

- `https://wiki.example.com/`
- `https://intranet.company.com/docs/`

Leave empty to activate on all pages.

### Allowed UNC Prefixes

List of UNC path prefixes that should be converted (one per line).

Examples:

- `\\fileserver\` - Matches all paths on this server
- `\\data-1\shared\` - Matches only paths under this share
- `\\data-1\shared` - Matches `\\data-1\shared` and `\\data-1\sharedfiles\`

Leave empty to allow all valid UNC paths.

**Note:** Matching is case-insensitive. A trailing backslash (`\`) requires an exact directory match; without it, any path with the same prefix matches.

## How It Works

1. When a page loads, the extension checks if the current URL matches any configured active URL prefix
2. If active, it scans for `<code>` elements that:
   - Are not editable (not inside `contenteditable` elements)
   - Contain exactly one text node as child
   - Have text between 3-260 characters (UTF-16 code units)
   - Start with `\\` (UNC path indicator)
   - Contain no invalid Windows filename characters (`< > : " | ? *` or control characters)
   - Match one of the allowed UNC prefixes (if configured)
3. Matching UNC paths are converted to clickable links
4. A MutationObserver watches for dynamically added content

## URL Scheme Handler

This extension only creates the links. You need a separate URL scheme handler to actually open the paths.

**Recommended companion application:** [UncOpener](https://github.com/bebuch/UncOpener) - A cross-platform Qt application that:

- Handles the custom URL scheme generated by this extension
- Validates paths against configurable allow-lists
- Opens UNC paths on Windows or converts to SMB URLs on Linux
- Provides filetype filtering for additional security

## Development

### Setup

1. Clone the repository:

   ```bash
   git clone https://github.com/bebuch/UncClickable.git
   cd UncClickable
   ```

2. Install dependencies:

   ```bash
   npm install
   ```

### Regenerating Icons

The icon PNGs are pre-built and committed to the repository. Regeneration is only needed if you modify `icons/icon.svg`.

**Prerequisites:**

- Inkscape
- ImageMagick

```bash
npm run generate-icons
```

### Running Tests

```bash
# Run tests in watch mode
npm test

# Run tests once
npm run test:run

# Run tests with coverage
npm run test:coverage
```

### Linting and Formatting

```bash
# Run ESLint on source files
npm run lint

# Run ESLint with automatic fixes
npm run lint:fix

# Format code with Prettier
npm run format

# Check code formatting without making changes
npm run format:check
```

### Project Structure

```
UncClickable/
├── manifest.json           # Extension manifest (Manifest V3)
├── package.json            # Project configuration and dependencies
├── eslint.config.js        # ESLint configuration
├── vitest.config.js        # Test configuration
├── src/
│   ├── background.js       # Service worker / background script
│   ├── content.js          # Content script injected into pages
│   └── utils/
│       └── unc-matcher.js  # UNC path validation and conversion utilities
├── options/
│   ├── options.html        # Settings page
│   ├── options.js          # Settings page logic
│   └── options.css         # Settings page styles
├── icons/                  # Extension icons (PNGs pre-built, regenerate only if SVG changes)
│   └── icon.svg            # Source icon
├── scripts/
│   └── generate-icons.sh   # Icon generation script
└── tests/                  # Unit and integration tests (Vitest)
    ├── setup.js            # Test setup and browser API mocks
    ├── unc-matcher.test.js # Tests for UNC path utilities
    ├── content.test.js     # Tests for content script logic
    ├── background.test.js  # Tests for background script
    ├── options.test.js     # Tests for options page
    ├── integration.test.js # Integration tests for component interactions
    └── mocks/
        └── browser-api.js  # Browser extension API mocks
```

## License

MIT License - see [LICENSE](LICENSE) file for details.
